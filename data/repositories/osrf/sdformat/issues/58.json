{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "links": {"attachments": {"href": "data/repositories/osrf/sdformat/issues/58/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/sdformat/issues/58.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/58/watch"}, "comments": {"href": "data/repositories/osrf/sdformat/issues/58/comments_page=1.json"}, "html": {"href": "#!/osrf/sdformat/issues/58/urdf-parsing-contents-of-visuals-in-gazebo"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/58/vote"}}, "reporter": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "title": "URDF parsing: contents of visuals in gazebo extension gets lumped to other visuals", "component": null, "votes": 0, "watches": 1, "content": {"raw": "For example, if I had an urdf with the following extension, to try and sneak sdf code into gazebo:\r\n~~~\r\n  <link name=\"l_foot\">\r\n    <inertial>\r\n      <mass value=\"1.634\"/>\r\n      <origin rpy=\"0 -0 0\" xyz=\"0.027 0 -0.067\"/>\r\n      <inertia ixx=\"0.002\" ixy=\"0\" ixz=\"0\" iyy=\"0.007\" iyz=\"0\" izz=\"0.008\"/>\r\n    </inertial>\r\n    <visual>\r\n      <origin rpy=\"0 -0 0\" xyz=\"0 0 0\"/>\r\n      <geometry>\r\n        <mesh filename=\"package://atlas_description/meshes/l_foot.dae\" scale=\"1 1 1\"/>\r\n      </geometry>\r\n    </visual>\r\n  </link>\r\n  <gazebo reference=\"l_foot\">\r\n    <visual name=\"l_foot_visual_soft\">\r\n      <pose>0.05 0 -0.05 0 0 0</pose>\r\n      <geometry>\r\n        <box>\r\n          <size>0.4 0.175 0.125</size>\r\n        </box>\r\n      </geometry>\r\n    </visual>\r\n  </gazebo>\r\n~~~\r\nThe sdf's [urdf parser lumps contents of visuals in extension](#!/osrf/sdformat/src/778bf6bc844dbff80ed6131627be1cc1618747c5/src/parser_urdf.cc?at=default#cl-1164) into the existing visual element of the urdf, resulting in a visual block that is a combination of the urdf visual and the sdf visual in the extension:\r\n~~~\r\n      <visual name='vis_l_foot_visual'>\r\n        <pose>0 0 0 0 -0 0</pose>\r\n        <geometry>\r\n          <mesh>\r\n            <scale>1 1 1</scale>\r\n            <uri>model://atlas_description/meshes/l_foot.dae</uri>\r\n          </mesh>\r\n        </geometry>\r\n        <pose>0.05 0 -0.05 0 -0 0</pose>\r\n        <geometry>\r\n          <box>\r\n            <size>0.4 0.175 0.125</size>\r\n          </box>\r\n        </geometry>\r\n      </visual>\r\n~~~\r\nCommenting out [this bit of special case code for `visual`](#!/osrf/sdformat/src/778bf6bc844dbff80ed6131627be1cc1618747c5/src/parser_urdf.cc?at=default#cl-1164) fixes this issue, but probably breaks something else.\r\n\r\nWe need a better way of adding sdf to models specified in urdf.  Especially when new things are introduced in sdf, pass it through from urdf in a more generic fashion.", "markup": "markdown", "html": "<p>For example, if I had an urdf with the following extension, to try and sneak sdf code into gazebo:</p>\n<div class=\"codehilite\"><pre><span></span>  <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;l_foot&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;inertial&gt;</span>\n      <span class=\"nt\">&lt;mass</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1.634&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 -0 0&quot;</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0.027 0 -0.067&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;inertia</span> <span class=\"na\">ixx=</span><span class=\"s\">&quot;0.002&quot;</span> <span class=\"na\">ixy=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">ixz=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">iyy=</span><span class=\"s\">&quot;0.007&quot;</span> <span class=\"na\">iyz=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">izz=</span><span class=\"s\">&quot;0.008&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/inertial&gt;</span>\n    <span class=\"nt\">&lt;visual&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 -0 0&quot;</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0 0 0&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;geometry&gt;</span>\n        <span class=\"nt\">&lt;mesh</span> <span class=\"na\">filename=</span><span class=\"s\">&quot;package://atlas_description/meshes/l_foot.dae&quot;</span> <span class=\"na\">scale=</span><span class=\"s\">&quot;1 1 1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/geometry&gt;</span>\n    <span class=\"nt\">&lt;/visual&gt;</span>\n  <span class=\"nt\">&lt;/link&gt;</span>\n  <span class=\"nt\">&lt;gazebo</span> <span class=\"na\">reference=</span><span class=\"s\">&quot;l_foot&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;visual</span> <span class=\"na\">name=</span><span class=\"s\">&quot;l_foot_visual_soft&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>0.05 0 -0.05 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n      <span class=\"nt\">&lt;geometry&gt;</span>\n        <span class=\"nt\">&lt;box&gt;</span>\n          <span class=\"nt\">&lt;size&gt;</span>0.4 0.175 0.125<span class=\"nt\">&lt;/size&gt;</span>\n        <span class=\"nt\">&lt;/box&gt;</span>\n      <span class=\"nt\">&lt;/geometry&gt;</span>\n    <span class=\"nt\">&lt;/visual&gt;</span>\n  <span class=\"nt\">&lt;/gazebo&gt;</span>\n</pre></div>\n\n\n<p>The sdf's <a data-is-external-link=\"true\" href=\"#!/osrf/sdformat/src/778bf6bc844dbff80ed6131627be1cc1618747c5/src/parser_urdf.cc?at=default#cl-1164\" rel=\"nofollow\">urdf parser lumps contents of visuals in extension</a> into the existing visual element of the urdf, resulting in a visual block that is a combination of the urdf visual and the sdf visual in the extension:</p>\n<div class=\"codehilite\"><pre><span></span>      <span class=\"nt\">&lt;visual</span> <span class=\"na\">name=</span><span class=\"s\">&#39;vis_l_foot_visual&#39;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0 0 0 0 -0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;mesh&gt;</span>\n            <span class=\"nt\">&lt;scale&gt;</span>1 1 1<span class=\"nt\">&lt;/scale&gt;</span>\n            <span class=\"nt\">&lt;uri&gt;</span>model://atlas_description/meshes/l_foot.dae<span class=\"nt\">&lt;/uri&gt;</span>\n          <span class=\"nt\">&lt;/mesh&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0.05 0 -0.05 0 -0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;box&gt;</span>\n            <span class=\"nt\">&lt;size&gt;</span>0.4 0.175 0.125<span class=\"nt\">&lt;/size&gt;</span>\n          <span class=\"nt\">&lt;/box&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n      <span class=\"nt\">&lt;/visual&gt;</span>\n</pre></div>\n\n\n<p>Commenting out <a data-is-external-link=\"true\" href=\"#!/osrf/sdformat/src/778bf6bc844dbff80ed6131627be1cc1618747c5/src/parser_urdf.cc?at=default#cl-1164\" rel=\"nofollow\">this bit of special case code for <code>visual</code></a> fixes this issue, but probably breaks something else.</p>\n<p>We need a better way of adding sdf to models specified in urdf.  Especially when new things are introduced in sdf, pass it through from urdf in a more generic fashion.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2014-04-09T19:42:52.728501+00:00", "milestone": null, "updated_on": "2014-04-09T19:42:52.728501+00:00", "type": "issue", "id": 58}