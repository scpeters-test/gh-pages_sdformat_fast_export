{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "links": {"attachments": {"href": "data/repositories/osrf/sdformat/issues/35/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/sdformat/issues/35.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/35/watch"}, "comments": {"href": "data/repositories/osrf/sdformat/issues/35/comments_page=1.json"}, "html": {"href": "#!/osrf/sdformat/issues/35/integration-tests-segfault-without-an"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/35/vote"}}, "reporter": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "title": "Integration tests segfault without an installed copy of sdformat", "component": null, "votes": 0, "watches": 2, "content": {"raw": "Trying to run the test suite just from the ```build/``` directory without installing sdformat, it's producing segfault in INTEGRATION tests. Seems to me like it is trying to locate root.sdf and it is not available.\r\n\r\nThis problem is making [jenkins debbuilder](http://build.osrfoundation.org/view/SDFormat/job/sdformat-debbuilder/394/console) to fail.\r\n\r\n**strace**\r\n```\r\nioctl(1, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon echo ...}) = 0\r\nwrite(1, \"\\33[0;32m[==========] \\33[mRunning 2\"..., 57) = 57\r\nwrite(1, \"\\33[0;32m[----------] \\33[mGlobal te\"..., 55) = 55\r\nwrite(1, \"\\33[0;32m[----------] \\33[m2 tests f\"..., 46) = 46\r\nwrite(1, \"\\33[0;32m[ RUN      ] \\33[mSDFParser\"..., 68) = 68\r\nstat(\"/usr/share/root.sdf\", 0x7fff3108f390) = -1 ENOENT (No such file or directory)\r\nstat(\"/usr/share/sdformat/1.4/root.sdf\", 0x7fff3108f390) = -1 ENOENT (No such file or directory)\r\nstat(\"root.sdf\", 0x7fff3108f380)        = -1 ENOENT (No such file or directory)\r\ngetcwd(\"/home/jrivero/code/sdformat/build\", 128) = 30\r\nstat(\"/home/jrivero/code/sdformat/build/root.sdf\", 0x7fff3108f380) = -1 ENOENT (No such file or directory)\r\nopen(\"\", O_RDONLY)                      = -1 ENOENT (No such file or directory)\r\nstat(\"/home/jrivero/.sdformat\", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0\r\nstat(\"/home/jrivero/.sdformat\", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0\r\nopen(\"/home/jrivero/.sdformat/sdformat.log\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\r\nwrite(2, \"\\33[1;\", 4^[[1;)                   = 4\r\nwrite(2, \"31\", 231)                       = 2\r\nwrite(2, \"m\", 1m)                        = 1 \r\nwrite(2, \"Error\", 5Error)                    = 5\r\nwrite(2, \" [\", 2 [)                       = 2\r\nwrite(2, \"parser.cc\", 9parser.cc)                = 9\r\nwrite(2, \":\", 1:)                        = 1\r\nwrite(2, \"49\", 249)                       = 2    \r\nwrite(2, \"]\\33[0m \", 6]^[[0m )                 = 6\r\nwrite(2, \"Unable to find or open SDF file[\", 32Unable to find or open SDF file[) = 32\r\nwrite(2, \"]\\n\", 2]\r\n\r\n```\r\n\r\n**GDB trace**\r\n```\r\n(gdb) run\r\nStarting program: /home/jrivero/code/sdformat/build/test/integration/INTEGRATION_fixed_joint_reduction \r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\nRunning main() from gtest_main.cc\r\n[==========] Running 2 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 2 tests from SDFParser\r\n[ RUN      ] SDFParser.FixedJointReductionEquivalenceTest\r\nError [parser.cc:49] Unable to find or open SDF file[]\r\nError [SDF.cc:788] Missing element description for [model]\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x00007ffff7b9524c in sdf::Element::HasElement(std::string const&) const ()\r\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\r\n(gdb) bt\r\n#0  0x00007ffff7b9524c in sdf::Element::HasElement(std::string const&) const ()\r\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\r\n#1  0x00007ffff7b96817 in sdf::Element::GetElement(std::string const&) ()\r\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\r\n#2  0x000000000041be50 in SDFParser_FixedJointReductionEquivalenceTest_Test::TestBody() ()\r\n#3  0x0000000000441edd in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ()\r\n#4  0x0000000000439a41 in testing::Test::Run() ()\r\n#5  0x0000000000439b26 in testing::TestInfo::Run() ()\r\n#6  0x0000000000439c67 in testing::TestCase::Run() ()\r\n#7  0x0000000000439fbe in testing::internal::UnitTestImpl::RunAllTests() ()\r\n#8  0x0000000000441a5d in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ()\r\n#9  0x000000000043909e in testing::UnitTest::Run() ()\r\n#10 0x00000000004176c9 in main ()\r\n```", "markup": "markdown", "html": "<p>Trying to run the test suite just from the <code>build/</code> directory without installing sdformat, it's producing segfault in INTEGRATION tests. Seems to me like it is trying to locate root.sdf and it is not available.</p>\n<p>This problem is making <a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/SDFormat/job/sdformat-debbuilder/394/console\" rel=\"nofollow\">jenkins debbuilder</a> to fail.</p>\n<p><strong>strace</strong></p>\n<div class=\"codehilite\"><pre><span></span>ioctl(1, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon echo ...}) = 0\nwrite(1, &quot;\\33[0;32m[==========] \\33[mRunning 2&quot;..., 57) = 57\nwrite(1, &quot;\\33[0;32m[----------] \\33[mGlobal te&quot;..., 55) = 55\nwrite(1, &quot;\\33[0;32m[----------] \\33[m2 tests f&quot;..., 46) = 46\nwrite(1, &quot;\\33[0;32m[ RUN      ] \\33[mSDFParser&quot;..., 68) = 68\nstat(&quot;/usr/share/root.sdf&quot;, 0x7fff3108f390) = -1 ENOENT (No such file or directory)\nstat(&quot;/usr/share/sdformat/1.4/root.sdf&quot;, 0x7fff3108f390) = -1 ENOENT (No such file or directory)\nstat(&quot;root.sdf&quot;, 0x7fff3108f380)        = -1 ENOENT (No such file or directory)\ngetcwd(&quot;/home/jrivero/code/sdformat/build&quot;, 128) = 30\nstat(&quot;/home/jrivero/code/sdformat/build/root.sdf&quot;, 0x7fff3108f380) = -1 ENOENT (No such file or directory)\nopen(&quot;&quot;, O_RDONLY)                      = -1 ENOENT (No such file or directory)\nstat(&quot;/home/jrivero/.sdformat&quot;, {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0\nstat(&quot;/home/jrivero/.sdformat&quot;, {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0\nopen(&quot;/home/jrivero/.sdformat/sdformat.log&quot;, O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\nwrite(2, &quot;\\33[1;&quot;, 4^[[1;)                   = 4\nwrite(2, &quot;31&quot;, 231)                       = 2\nwrite(2, &quot;m&quot;, 1m)                        = 1 \nwrite(2, &quot;Error&quot;, 5Error)                    = 5\nwrite(2, &quot; [&quot;, 2 [)                       = 2\nwrite(2, &quot;parser.cc&quot;, 9parser.cc)                = 9\nwrite(2, &quot;:&quot;, 1:)                        = 1\nwrite(2, &quot;49&quot;, 249)                       = 2    \nwrite(2, &quot;]\\33[0m &quot;, 6]^[[0m )                 = 6\nwrite(2, &quot;Unable to find or open SDF file[&quot;, 32Unable to find or open SDF file[) = 32\nwrite(2, &quot;]\\n&quot;, 2]\n</pre></div>\n\n\n<p><strong>GDB trace</strong></p>\n<div class=\"codehilite\"><pre><span></span>(gdb) run\nStarting program: /home/jrivero/code/sdformat/build/test/integration/INTEGRATION_fixed_joint_reduction \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.\nRunning main() from gtest_main.cc\n[==========] Running 2 tests from 1 test case.\n[----------] Global test environment set-up.\n[----------] 2 tests from SDFParser\n[ RUN      ] SDFParser.FixedJointReductionEquivalenceTest\nError [parser.cc:49] Unable to find or open SDF file[]\nError [SDF.cc:788] Missing element description for [model]\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff7b9524c in sdf::Element::HasElement(std::string const&amp;) const ()\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\n(gdb) bt\n#0  0x00007ffff7b9524c in sdf::Element::HasElement(std::string const&amp;) const ()\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\n#1  0x00007ffff7b96817 in sdf::Element::GetElement(std::string const&amp;) ()\n   from /home/jrivero/code/sdformat/build/src/libsdformat.so.1\n#2  0x000000000041be50 in SDFParser_FixedJointReductionEquivalenceTest_Test::TestBody() ()\n#3  0x0000000000441edd in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) ()\n#4  0x0000000000439a41 in testing::Test::Run() ()\n#5  0x0000000000439b26 in testing::TestInfo::Run() ()\n#6  0x0000000000439c67 in testing::TestCase::Run() ()\n#7  0x0000000000439fbe in testing::internal::UnitTestImpl::RunAllTests() ()\n#8  0x0000000000441a5d in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ()\n#9  0x000000000043909e in testing::UnitTest::Run() ()\n#10 0x00000000004176c9 in main ()\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2013-10-31T18:00:16.835202+00:00", "milestone": null, "updated_on": "2015-02-11T20:19:46.190996+00:00", "type": "issue", "id": 35}