{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "links": {"attachments": {"href": "data/repositories/osrf/sdformat/issues/197/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/sdformat/issues/197.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/197/watch"}, "comments": {"href": "data/repositories/osrf/sdformat/issues/197/comments_page=1.json"}, "html": {"href": "#!/osrf/sdformat/issues/197/hard-to-set-urdf-model-to-static-with"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/197/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "Hard to set URDF model to static with multiple <gazebo> tags", "component": null, "votes": 1, "watches": 2, "content": {"raw": "@caguero and I discovered today that if you want to use `<gazebo>` to make a urdf model static, you might run into problems if you have multiple `<gazebo>` tags. For example, the following urdf will not be static after converting to sdf:\r\n\r\n~~~\r\n<?xml version=\"1.0\" ?>\r\n<robot name=\"static_test\">\r\n\r\n  <link name=\"world\"/>\r\n  <gazebo>\r\n    <static>1</static>\r\n  </gazebo>\r\n  <gazebo/>\r\n\r\n</robot>\r\n~~~\r\n\r\n~~~\r\n$ gz sdf -p test/integration/static_test.urdf \r\nWarning [parser_urdf.cc:1115] multiple inconsistent <static> exists due to fixed joint reduction overwriting previous value [true] with [false].\r\n<sdf version='1.6'>\r\n  <model name='static_test'>\r\n    <static>0</static>\r\n  </model>\r\n</sdf>\r\n~~~\r\n\r\nIt gives a warning: \"Warning [parser_urdf.cc:1115] multiple inconsistent <static> exists due to fixed joint reduction overwriting previous value [true] with [false].\"\r\n\r\nI think the following code might fix the parsing for this specific model, relying on the fact that sdf models are not static by default, but it may have side-effects for other models.\r\n\r\n~~~\r\ndiff -r 5d148a84b301 src/parser_urdf.cc\r\n--- a/src/parser_urdf.cc        Thu Oct 26 14:18:25 2017 -0700\r\n+++ b/src/parser_urdf.cc        Wed Aug 29 17:43:43 2018 -0700\r\n@@ -2346,8 +2346,6 @@\r\n         // insert static flag\r\n         if ((*ge)->setStaticFlag)\r\n           AddKeyValue(_elem, \"static\", \"true\");\r\n-        else\r\n-          AddKeyValue(_elem, \"static\", \"false\");\r\n \r\n         // copy extension containing blobs and without reference\r\n         for (std::vector<TiXmlElementPtr>::iterator\r\n~~~", "markup": "markdown", "html": "<p>@caguero and I discovered today that if you want to use <code>&lt;gazebo&gt;</code> to make a urdf model static, you might run into problems if you have multiple <code>&lt;gazebo&gt;</code> tags. For example, the following urdf will not be static after converting to sdf:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>\n<span class=\"nt\">&lt;robot</span> <span class=\"na\">name=</span><span class=\"s\">&quot;static_test&quot;</span><span class=\"nt\">&gt;</span>\n\n  <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;world&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;gazebo&gt;</span>\n    <span class=\"nt\">&lt;static&gt;</span>1<span class=\"nt\">&lt;/static&gt;</span>\n  <span class=\"nt\">&lt;/gazebo&gt;</span>\n  <span class=\"nt\">&lt;gazebo/&gt;</span>\n\n<span class=\"nt\">&lt;/robot&gt;</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>$ gz sdf -p test/integration/static_test.urdf \nWarning [parser_urdf.cc:1115] multiple inconsistent <span class=\"nt\">&lt;static&gt;</span> exists due to fixed joint reduction overwriting previous value [true] with [false].\n<span class=\"nt\">&lt;sdf</span> <span class=\"na\">version=</span><span class=\"s\">&#39;1.6&#39;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;model</span> <span class=\"na\">name=</span><span class=\"s\">&#39;static_test&#39;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;static&gt;</span>0<span class=\"nt\">&lt;/static&gt;</span>\n  <span class=\"nt\">&lt;/model&gt;</span>\n<span class=\"nt\">&lt;/sdf&gt;</span>\n</pre></div>\n\n\n<p>It gives a warning: \"Warning [parser_urdf.cc:1115] multiple inconsistent &lt;static&gt; exists due to fixed joint reduction overwriting previous value [true] with [false].\"</p>\n<p>I think the following code might fix the parsing for this specific model, relying on the fact that sdf models are not static by default, but it may have side-effects for other models.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 5d148a84b301 src/parser_urdf.cc</span>\n<span class=\"gd\">--- a/src/parser_urdf.cc        Thu Oct 26 14:18:25 2017 -0700</span>\n<span class=\"gi\">+++ b/src/parser_urdf.cc        Wed Aug 29 17:43:43 2018 -0700</span>\n<span class=\"gu\">@@ -2346,8 +2346,6 @@</span>\n         // insert static flag\n         if ((*ge)-&gt;setStaticFlag)\n           AddKeyValue(_elem, &quot;static&quot;, &quot;true&quot;);\n<span class=\"gd\">-        else</span>\n<span class=\"gd\">-          AddKeyValue(_elem, &quot;static&quot;, &quot;false&quot;);</span>\n\n         // copy extension containing blobs and without reference\n         for (std::vector&lt;TiXmlElementPtr&gt;::iterator\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2018-08-30T01:01:01.805374+00:00", "milestone": null, "updated_on": "2018-08-30T01:01:01.805374+00:00", "type": "issue", "id": 197}