{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "links": {"attachments": {"href": "data/repositories/osrf/sdformat/issues/13/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/sdformat/issues/13.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/13/watch"}, "comments": {"href": "data/repositories/osrf/sdformat/issues/13/comments_page=1.json"}, "html": {"href": "#!/osrf/sdformat/issues/13/urdf-parser-leaks-memory"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/sdformat/issues/13/vote"}}, "reporter": {"display_name": "Brian Gerkey", "uuid": "{3d8b5763-9dad-4be7-85c2-a7ab6cd49173}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D"}, "html": {"href": "https://bitbucket.org/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9/5fa9ec73-0fec-4860-a202-e34ae23b6a12/128"}}, "nickname": "Brian Gerkey", "type": "user", "account_id": "557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9"}, "title": "URDF parser leaks memory", "component": null, "votes": 0, "watches": 0, "content": {"raw": "There are quite a few uses of `new` without any uses of `delete` in `src/parser_urdf.cc`.\r\n\r\nHere's what valgrind has to say about `test/performance/parser_urdf`:\r\n\r\n~~~\r\n==9201== HEAP SUMMARY:\r\n==9201==     in use at exit: 312,866 bytes in 3,381 blocks\r\n==9201==   total heap usage: 695,236 allocs, 691,855 frees, 47,452,459 bytes allocated\r\n==9201== \r\n==9201== Searching for pointers to 3,381 not-freed blocks\r\n==9201== Checked 309,264 bytes\r\n==9201== \r\n==9201== 6,584 (88 direct, 6,496 indirect) bytes in 1 blocks are definitely lost in loss record 32 of 47\r\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==9201==    by 0x4E8383B: ReduceSDFExtensionSensorTransformReduction(__gnu_cxx::__normal_iterator<TiXmlElement**, std::vector<TiXmlElement*, std::allocator<TiXmlElement*> > >, sdf::Pose) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E83EF8: ReduceSDFExtensionsTransform(sdf::SDFExtension*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E917F1: ReduceSDFExtensionToParent(boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E91FDF: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E91EE6: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92433: sdf::URDF2SDF::InitModelString(std::string const&, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201== \r\n==9201== 6,584 (144 direct, 6,440 indirect) bytes in 1 blocks are definitely lost in loss record 33 of 47\r\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==9201==    by 0x4E83886: ReduceSDFExtensionSensorTransformReduction(__gnu_cxx::__normal_iterator<TiXmlElement**, std::vector<TiXmlElement*, std::allocator<TiXmlElement*> > >, sdf::Pose) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E83EF8: ReduceSDFExtensionsTransform(sdf::SDFExtension*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E917F1: ReduceSDFExtensionToParent(boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E91FDF: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E91EE6: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr<urdf::Link>) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92433: sdf::URDF2SDF::InitModelString(std::string const&, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201== \r\n==9201== 298,882 (96,600 direct, 202,282 indirect) bytes in 345 blocks are definitely lost in loss record 47 of 47\r\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==9201==    by 0x4E8AD46: sdf::URDF2SDF::ParseSDFExtension(TiXmlDocument&) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E923BD: sdf::URDF2SDF::InitModelString(std::string const&, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E92805: sdf::URDF2SDF::InitModelDoc(TiXmlDocument*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x4E9290A: sdf::URDF2SDF::InitModelFile(std::string const&) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\r\n==9201==    by 0x413B87: URDFParser_AtlasURDF_5runs_performance_Test::TestBody() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x4312AC: void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x428C90: testing::Test::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x428D75: testing::TestInfo::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x428EB6: testing::TestCase::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x42920D: testing::internal::UnitTestImpl::RunAllTests() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201==    by 0x430E2C: bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\r\n==9201== \r\n==9201== LEAK SUMMARY:\r\n==9201==    definitely lost: 96,832 bytes in 347 blocks\r\n==9201==    indirectly lost: 215,218 bytes in 3,033 blocks\r\n==9201==      possibly lost: 0 bytes in 0 blocks\r\n==9201==    still reachable: 816 bytes in 1 blocks\r\n==9201==         suppressed: 0 bytes in 0 blocks\r\n==9201== Reachable blocks (those to which a pointer was found) are not shown.\r\n==9201== To see them, rerun with: --leak-check=full --show-reachable=yes\r\n~~~\r\n\r\n\r\n", "markup": "markdown", "html": "<p>There are quite a few uses of <code>new</code> without any uses of <code>delete</code> in <code>src/parser_urdf.cc</code>.</p>\n<p>Here's what valgrind has to say about <code>test/performance/parser_urdf</code>:</p>\n<div class=\"codehilite\"><pre><span></span>==9201== HEAP SUMMARY:\n==9201==     in use at exit: 312,866 bytes in 3,381 blocks\n==9201==   total heap usage: 695,236 allocs, 691,855 frees, 47,452,459 bytes allocated\n==9201== \n==9201== Searching for pointers to 3,381 not-freed blocks\n==9201== Checked 309,264 bytes\n==9201== \n==9201== 6,584 (88 direct, 6,496 indirect) bytes in 1 blocks are definitely lost in loss record 32 of 47\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==9201==    by 0x4E8383B: ReduceSDFExtensionSensorTransformReduction(__gnu_cxx::__normal_iterator&lt;TiXmlElement**, std::vector&lt;TiXmlElement*, std::allocator&lt;TiXmlElement*&gt; &gt; &gt;, sdf::Pose) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E83EF8: ReduceSDFExtensionsTransform(sdf::SDFExtension*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E917F1: ReduceSDFExtensionToParent(boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E91FDF: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E91EE6: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92433: sdf::URDF2SDF::InitModelString(std::string const&amp;, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201== \n==9201== 6,584 (144 direct, 6,440 indirect) bytes in 1 blocks are definitely lost in loss record 33 of 47\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==9201==    by 0x4E83886: ReduceSDFExtensionSensorTransformReduction(__gnu_cxx::__normal_iterator&lt;TiXmlElement**, std::vector&lt;TiXmlElement*, std::allocator&lt;TiXmlElement*&gt; &gt; &gt;, sdf::Pose) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E83EF8: ReduceSDFExtensionsTransform(sdf::SDFExtension*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E917F1: ReduceSDFExtensionToParent(boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E91FDF: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E91EE6: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92113: ReduceFixedJoints(TiXmlElement*, boost::shared_ptr&lt;urdf::Link&gt;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92433: sdf::URDF2SDF::InitModelString(std::string const&amp;, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201== \n==9201== 298,882 (96,600 direct, 202,282 indirect) bytes in 345 blocks are definitely lost in loss record 47 of 47\n==9201==    at 0x4C2B1C7: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==9201==    by 0x4E8AD46: sdf::URDF2SDF::ParseSDFExtension(TiXmlDocument&amp;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E923BD: sdf::URDF2SDF::InitModelString(std::string const&amp;, bool) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E92805: sdf::URDF2SDF::InitModelDoc(TiXmlDocument*) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x4E9290A: sdf::URDF2SDF::InitModelFile(std::string const&amp;) (in /home/gerkey/code/drc/sdformat/build/src/libsdformat.so.1.4.3)\n==9201==    by 0x413B87: URDFParser_AtlasURDF_5runs_performance_Test::TestBody() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x4312AC: void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x428C90: testing::Test::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x428D75: testing::TestInfo::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x428EB6: testing::TestCase::Run() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x42920D: testing::internal::UnitTestImpl::RunAllTests() (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201==    by 0x430E2C: bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (in /home/gerkey/code/drc/sdformat/build/test/performance/parser_urdf)\n==9201== \n==9201== LEAK SUMMARY:\n==9201==    definitely lost: 96,832 bytes in 347 blocks\n==9201==    indirectly lost: 215,218 bytes in 3,033 blocks\n==9201==      possibly lost: 0 bytes in 0 blocks\n==9201==    still reachable: 816 bytes in 1 blocks\n==9201==         suppressed: 0 bytes in 0 blocks\n==9201== Reachable blocks (those to which a pointer was found) are not shown.\n==9201== To see them, rerun with: --leak-check=full --show-reachable=yes\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Brian Gerkey", "uuid": "{3d8b5763-9dad-4be7-85c2-a7ab6cd49173}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D"}, "html": {"href": "https://bitbucket.org/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9/5fa9ec73-0fec-4860-a202-e34ae23b6a12/128"}}, "nickname": "Brian Gerkey", "type": "user", "account_id": "557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2013-07-18T00:01:37.559652+00:00", "milestone": null, "updated_on": "2013-08-01T00:24:10.284706+00:00", "type": "issue", "id": 13}