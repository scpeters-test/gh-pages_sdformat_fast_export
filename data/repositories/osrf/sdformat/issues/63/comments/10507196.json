{"links": {"self": {"href": "data/repositories/osrf/sdformat/issues/63/comments/10507196.json"}, "html": {"href": "#!/osrf/sdformat/issues/63#comment-10507196"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/sdformat/issues/63.json"}}, "type": "issue", "id": 63, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "title": "gzsdf segfaults in trusty"}, "content": {"raw": "At first moment, I was not able to reproduce the error with the example attached here but Steve pointed me to use the nao description and I end up discovering that a basic example with a fixed joint is enough to trigger the segfault:\n\n```\n<robot name=\"test_robot\">\n  <link name=\"link1\" />\n  <link name=\"link2\" />\n\n  <joint name=\"joint1\" type=\"fixed\">\n    <parent link=\"link1\"/>\n    <child link=\"link2\"/>\n  </joint>\n</robot>\n```\n\nAfter build sdformat packages using Debug cmake build type some more interesting details appeared:\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\nReduceFixedJoints (_root=_root@entry=0x7724c0, _link=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:389\n389\t    if (_link->child_links[i]->parent_joint->type == urdf::Joint::FIXED)\n(gdb) bt\n#0  ReduceFixedJoints (_root=_root@entry=0x7724c0, _link=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:389\n#1  0x00007ffff76c6fa2 in sdf::URDF2SDF::InitModelString (this=this@entry=0x7fffffffdc7d, _urdfStr=..., _enforceLimits=_enforceLimits@entry=true)\n    at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2667\n#2  0x00007ffff76c75a4 in sdf::URDF2SDF::InitModelDoc (this=this@entry=0x7fffffffdc7d, _xmlDoc=_xmlDoc@entry=0x7fffffffdbb0) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2706\n#3  0x00007ffff76c7708 in sdf::URDF2SDF::InitModelFile (this=this@entry=0x7fffffffdc7d, _filename=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2715\n#4  0x00007ffff76a1aa3 in sdf::readFile (_filename=..., _sdf=...) at /tmp/sdformat-1.4.11/src/parser.cc:265\n#5  0x0000000000403e60 in main ()\n```\nThe value of ```child_links.size()``` when the segfault occurs is garbage. If we built sdformat packages using embedded copy of the urdfdom, the problem is not present so it should be something in the code of urdfdom packages.\n\nAfter my time debugging, if I try to run the same non segfaulting example attached here, now it segfaults, in the same place.", "markup": "markdown", "html": "<p>At first moment, I was not able to reproduce the error with the example attached here but Steve pointed me to use the nao description and I end up discovering that a basic example with a fixed joint is enough to trigger the segfault:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;robot</span> <span class=\"na\">name=</span><span class=\"s\">&quot;test_robot&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;link1&quot;</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;link2&quot;</span> <span class=\"nt\">/&gt;</span>\n\n  <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;joint1&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;link1&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;link2&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/joint&gt;</span>\n<span class=\"nt\">&lt;/robot&gt;</span>\n</pre></div>\n\n\n<p>After build sdformat packages using Debug cmake build type some more interesting details appeared:</p>\n<div class=\"codehilite\"><pre><span></span>Program received signal SIGSEGV, Segmentation fault.\nReduceFixedJoints (_root=_root@entry=0x7724c0, _link=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:389\n389     if (_link-&gt;child_links[i]-&gt;parent_joint-&gt;type == urdf::Joint::FIXED)\n(gdb) bt\n#0  ReduceFixedJoints (_root=_root@entry=0x7724c0, _link=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:389\n#1  0x00007ffff76c6fa2 in sdf::URDF2SDF::InitModelString (this=this@entry=0x7fffffffdc7d, _urdfStr=..., _enforceLimits=_enforceLimits@entry=true)\n    at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2667\n#2  0x00007ffff76c75a4 in sdf::URDF2SDF::InitModelDoc (this=this@entry=0x7fffffffdc7d, _xmlDoc=_xmlDoc@entry=0x7fffffffdbb0) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2706\n#3  0x00007ffff76c7708 in sdf::URDF2SDF::InitModelFile (this=this@entry=0x7fffffffdc7d, _filename=...) at /tmp/sdformat-1.4.11/src/parser_urdf.cc:2715\n#4  0x00007ffff76a1aa3 in sdf::readFile (_filename=..., _sdf=...) at /tmp/sdformat-1.4.11/src/parser.cc:265\n#5  0x0000000000403e60 in main ()\n</pre></div>\n\n\n<p>The value of <code>child_links.size()</code> when the segfault occurs is garbage. If we built sdformat packages using embedded copy of the urdfdom, the problem is not present so it should be something in the code of urdfdom packages.</p>\n<p>After my time debugging, if I try to run the same non segfaulting example attached here, now it segfaults, in the same place.</p>", "type": "rendered"}, "created_on": "2014-06-03T01:45:31.329155+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 10507196}