{"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/77/comments/926757.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/77/_/diff#comment-926757"}}, "parent": {"id": 917387, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/77/comments/917387.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/77/_/diff#comment-917387"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 77, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/77.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/77"}}, "title": "Support to use external URDF"}, "content": {"raw": "It has to do with the changes at line 303 of parser_urdf.cc.  From urdf_model/link.h:\n\n\n```\n#!c++\n\n  /// if more than one visual element is specified, all visual elements are placed in this array (the visual member will be NULL)\n  std::vector<boost::shared_ptr<Visual> > visual_array;\n\n```\n\nI think what's happening is that there is only one visual element, so we should be using the \"visual\" member instead of the \"visual_array\" member.  I made the following change and the unit tests now pass:\n\n\n```\n#!c++\n\n#if USE_EXTERNAL_URDF\n  boost::shared_ptr<std::vector<UrdfVisualPtr> > viss;\n  if (_link->visual) {\n    viss.reset(new std::vector<UrdfVisualPtr> );\n    viss->push_back(_link->visual);\n  }\n  else {\n    viss = boost::shared_ptr<std::vector<UrdfVisualPtr> >(&_link->visual_array);\n  }\n#else\n  boost::shared_ptr<std::vector<UrdfVisualPtr> > viss\n    = _link->getVisuals(_groupName);\n#endif\n\n```", "markup": "markdown", "html": "<p>It has to do with the changes at line 303 of parser_urdf.cc.  From urdf_model/link.h:</p>\n<div class=\"codehilite language-c++\"><pre><span></span>  <span class=\"c1\">/// if more than one visual element is specified, all visual elements are placed in this array (the visual member will be NULL)</span>\n  <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">Visual</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span> <span class=\"n\">visual_array</span><span class=\"p\">;</span>\n</pre></div>\n\n\n<p>I think what's happening is that there is only one visual element, so we should be using the \"visual\" member instead of the \"visual_array\" member.  I made the following change and the unit tests now pass:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"cp\">#if USE_EXTERNAL_URDF</span>\n  <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">UrdfVisualPtr</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span> <span class=\"n\">viss</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">_link</span><span class=\"o\">-&gt;</span><span class=\"n\">visual</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"n\">viss</span><span class=\"p\">.</span><span class=\"n\">reset</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">UrdfVisualPtr</span><span class=\"o\">&gt;</span> <span class=\"p\">);</span>\n    <span class=\"n\">viss</span><span class=\"o\">-&gt;</span><span class=\"n\">push_back</span><span class=\"p\">(</span><span class=\"n\">_link</span><span class=\"o\">-&gt;</span><span class=\"n\">visual</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"n\">viss</span> <span class=\"o\">=</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">UrdfVisualPtr</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">_link</span><span class=\"o\">-&gt;</span><span class=\"n\">visual_array</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"cp\">#else</span>\n  <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">UrdfVisualPtr</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span> <span class=\"n\">viss</span>\n    <span class=\"o\">=</span> <span class=\"n\">_link</span><span class=\"o\">-&gt;</span><span class=\"n\">getVisuals</span><span class=\"p\">(</span><span class=\"n\">_groupName</span><span class=\"p\">);</span>\n<span class=\"cp\">#endif</span>\n</pre></div>", "type": "rendered"}, "created_on": "2013-12-10T02:11:57.353335+00:00", "user": {"display_name": "Rich Mattes", "uuid": "{1ef6f3dd-b8db-412b-94e9-e430e7aafd23}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1ef6f3dd-b8db-412b-94e9-e430e7aafd23%7D"}, "html": {"href": "https://bitbucket.org/%7B1ef6f3dd-b8db-412b-94e9-e430e7aafd23%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d431baafeedf5d8921cb50a3c9902e16d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRM-0.png"}}, "nickname": "richmattes", "type": "user", "account_id": "557058:a38935e3-9a08-40d9-917a-ff19973e58df"}, "updated_on": "2013-12-10T02:11:57.465447+00:00", "type": "pullrequest_comment", "id": 926757}