{"pagelen": 50, "values": [{"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "5b51ff12b340", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5b51ff12b340.json"}, "html": {"href": "#!/osrf/sdformat/commits/5b51ff12b340"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "MERGED", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-22T00:32:57.499197+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "5b51ff12b340", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5b51ff12b340.json"}, "html": {"href": "#!/osrf/sdformat/commits/5b51ff12b340"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-22T00:04:14.771269+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "5b51ff12b340", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5b51ff12b340.json"}, "html": {"href": "#!/osrf/sdformat/commits/5b51ff12b340"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-22T00:04:14.631513+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/121126502.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-121126502"}}, "parent": {"id": 118553799, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553799.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553799"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I think it's still true. Before, you could have a relative path for a mesh and if the file existed w.r.t. the path you're running `ign gazebo` from, that would work. Now it will use the path relative to the model file path.", "markup": "markdown", "html": "<p>I think it's still true. Before, you could have a relative path for a mesh and if the file existed w.r.t. the path you're running <code>ign gazebo</code> from, that would work. Now it will use the path relative to the model file path.</p>", "type": "rendered"}, "created_on": "2019-10-17T11:17:19.654280+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-10-17T11:17:19.667594+00:00", "type": "pullrequest_comment", "id": 121126502}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/121122681.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-121122681"}}, "parent": {"id": 118727498, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118727498.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118727498"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Do you have a way of reproducing the issue you're talking about? Using `<include><uri>` in [this world](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff#chg-examples/worlds/fuel.sdf) works for me.\n\nOr maybe you're talking about having a relative path within `<include><uri>` itself? Such as loading a model relative to the path of the world file? If so, yes, I think it currently doesn't work and we could address this later.", "markup": "markdown", "html": "<p>Do you have a way of reproducing the issue you're talking about? Using <code>&lt;include&gt;&lt;uri&gt;</code> in <a data-is-external-link=\"true\" href=\"https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff#chg-examples/worlds/fuel.sdf\" rel=\"nofollow\">this world</a> works for me.</p>\n<p>Or maybe you're talking about having a relative path within <code>&lt;include&gt;&lt;uri&gt;</code> itself? Such as loading a model relative to the path of the world file? If so, yes, I think it currently doesn't work and we could address this later.</p>", "type": "rendered"}, "created_on": "2019-10-17T10:56:33.547557+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-10-17T10:56:33.558572+00:00", "type": "pullrequest_comment", "id": 121122681}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/121116481.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-121116481"}}, "parent": {"id": 118552647, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118552647.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118552647"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "The idea here is that removing an element from its parent doesn't change the path of the file that was used to load it. I agree that the logic seems misplaced though, I'm open to suggestions.", "markup": "markdown", "html": "<p>The idea here is that removing an element from its parent doesn't change the path of the file that was used to load it. I agree that the logic seems misplaced though, I'm open to suggestions.</p>", "type": "rendered"}, "created_on": "2019-10-17T10:22:09.064479+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-10-17T10:22:09.074009+00:00", "type": "pullrequest_comment", "id": 121116481}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/121116140.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-121116140"}}, "parent": {"id": 118553396, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553396.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553396"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I don't remember exactly now, but I think it was a shortcut to prevent iterating over all `SDF_PATH`s when we have an absolute path. But that wouldn't explain why @{557058:2c346146-0d72-44b3-90d5-a2798699a6d7} saw a test failure.", "markup": "markdown", "html": "<p>I don't remember exactly now, but I think it was a shortcut to prevent iterating over all <code>SDF_PATH</code>s when we have an absolute path. But that wouldn't explain why <span class=\"ap-mention\" data-atlassian-id=\"557058:2c346146-0d72-44b3-90d5-a2798699a6d7\">@Steve Peters</span> saw a test failure.</p>", "type": "rendered"}, "created_on": "2019-10-17T10:20:14.796821+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-10-17T10:20:14.901772+00:00", "type": "pullrequest_comment", "id": 121116140}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/120841665.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-120841665"}}, "parent": {"id": 120820127, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/120820127.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-120820127"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "8.4.0~pre1 prerelease is building", "markup": "markdown", "html": "<p>8.4.0~pre1 prerelease is building</p>", "type": "rendered"}, "created_on": "2019-10-15T20:34:07.298913+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-10-15T20:34:07.311195+00:00", "type": "pullrequest_comment", "id": 120841665}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "e0e51d776ccf", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/e0e51d776ccf.json"}, "html": {"href": "#!/osrf/sdformat/commits/e0e51d776ccf"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-15T20:33:40.343533+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "5e2e85309d75", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e2e85309d75.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e2e85309d75"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-15T20:30:25.287639+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "89b29ab04aba", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/89b29ab04aba.json"}, "html": {"href": "#!/osrf/sdformat/commits/89b29ab04aba"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-15T20:26:33.099989+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "2077d3d18a67", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/2077d3d18a67.json"}, "html": {"href": "#!/osrf/sdformat/commits/2077d3d18a67"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "89b29ab04aba", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/89b29ab04aba.json"}, "html": {"href": "#!/osrf/sdformat/commits/89b29ab04aba"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-10-15T20:26:28.944614+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/120820127.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-120820127"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I'll make a prerelease of this branch so we can test it with the ign-gazebo PR", "markup": "markdown", "html": "<p>I'll make a prerelease of this branch so we can test it with the ign-gazebo PR</p>", "type": "rendered"}, "created_on": "2019-10-15T17:33:54.081822+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-10-15T17:33:54.089149+00:00", "type": "pullrequest_comment", "id": 120820127}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/120817329.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-120817329"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Any chance this can get merged soon? It would be really useful for previewing models without uploading to Fuel.", "markup": "markdown", "html": "<p>Any chance this can get merged soon? It would be really useful for previewing models without uploading to Fuel.</p>", "type": "rendered"}, "created_on": "2019-10-15T17:11:19.866461+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-10-15T17:11:19.872166+00:00", "type": "pullrequest_comment", "id": 120817329}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"approval": {"date": "2019-09-28T02:21:14.107248+00:00", "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118727498.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118727498"}}, "parent": {"id": 118556979, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118556979.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118556979"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Okay, I think meshes are fine. The problem is with `<include><uri>` tags because the included file has to be found by the parser when calling `Root::Load` before DOM objects are created. We might have to pass in the `FilePath` as a second argument to the `findFile` callback. Addressing this seems to be out of scope for this PR so I'll go ahead and approve.", "markup": "markdown", "html": "<p>Okay, I think meshes are fine. The problem is with <code>&lt;include&gt;&lt;uri&gt;</code> tags because the included file has to be found by the parser when calling <code>Root::Load</code> before DOM objects are created. We might have to pass in the <code>FilePath</code> as a second argument to the <code>findFile</code> callback. Addressing this seems to be out of scope for this PR so I'll go ahead and approve.</p>", "type": "rendered"}, "created_on": "2019-09-28T02:21:08.182074+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-09-28T02:21:08.193143+00:00", "type": "pullrequest_comment", "id": 118727498}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118556979.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118556979"}}, "parent": {"id": 118553799, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553799.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553799"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I'm unapproving because I just started looking into how ign-gazebo might use `Mesh::FilePath` and encountered what I think might be a roadblock. In the current implementation, resources are fetched via a callback function which doesn't have access to the `FilePath` of the containing object. I haven't delved into it yet, but thought we should hold off till we have a clear way of implementing it in ign-gazebo.", "markup": "markdown", "html": "<p>I'm unapproving because I just started looking into how ign-gazebo might use <code>Mesh::FilePath</code> and encountered what I think might be a roadblock. In the current implementation, resources are fetched via a callback function which doesn't have access to the <code>FilePath</code> of the containing object. I haven't delved into it yet, but thought we should hold off till we have a clear way of implementing it in ign-gazebo.</p>", "type": "rendered"}, "created_on": "2019-09-26T20:59:56.028518+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-09-26T20:59:56.041402+00:00", "type": "pullrequest_comment", "id": 118556979}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118555578.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118555578"}}, "parent": {"id": 118555534, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118555534.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118555534"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I remember reverting the change and testing, but I can't remember what exactly failed", "markup": "markdown", "html": "<p>I remember reverting the change and testing, but I can't remember what exactly failed</p>", "type": "rendered"}, "created_on": "2019-09-26T20:47:16.250889+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-26T20:47:16.264503+00:00", "type": "pullrequest_comment", "id": 118555578}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118555534.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118555534"}}, "parent": {"id": 118553396, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553396.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553396"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I think it caused a test failure?", "markup": "markdown", "html": "<p>I think it caused a test failure?</p>", "type": "rendered"}, "created_on": "2019-09-26T20:46:49.980284+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-26T20:46:49.994471+00:00", "type": "pullrequest_comment", "id": 118555534}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553799.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553799"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Looks good to me! Left a couple of minor questions. Also, is the statement about this PR breaking relative paths in ign gazebo still true?", "markup": "markdown", "html": "<p>Looks good to me! Left a couple of minor questions. Also, is the statement about this PR breaking relative paths in ign gazebo still true?</p>", "type": "rendered"}, "created_on": "2019-09-26T20:31:02.521408+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-09-26T20:31:02.529156+00:00", "type": "pullrequest_comment", "id": 118553799}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118553396.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118553396"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Can I ask why this was moved up here?", "markup": "markdown", "html": "<p>Can I ask why this was moved up here?</p>", "type": "rendered"}, "created_on": "2019-09-26T20:27:30.024233+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {}, "updated_on": "2019-09-26T20:27:30.033622+00:00", "type": "pullrequest_comment", "id": 118553396}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/118552647.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-118552647"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Is it okay that the filepath is not reset if a nullptr parent is passed in?", "markup": "markdown", "html": "<p>Is it okay that the filepath is not reset if a nullptr parent is passed in?</p>", "type": "rendered"}, "created_on": "2019-09-26T20:20:44.572095+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {}, "updated_on": "2019-09-26T20:20:44.579541+00:00", "type": "pullrequest_comment", "id": 118552647}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "59e220fd6466", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/59e220fd6466.json"}, "html": {"href": "#!/osrf/sdformat/commits/59e220fd6466"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "53677d793d31", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/53677d793d31.json"}, "html": {"href": "#!/osrf/sdformat/commits/53677d793d31"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "date": "2019-09-26T20:06:52.946541+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"approval": {"date": "2019-09-20T22:35:09.567914+00:00", "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nYou'll need [this](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff) `ign-gazebo` PR.\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* ~~With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?~~ Now `Uri()` is the same as the raw `<uri>`\r\n* ~~It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)~~ Now SDF is only storing `FilePath` and `ign-gazebo` is combining them before populating the message.", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "5e4a0b3b5f2b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e4a0b3b5f2b.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e4a0b3b5f2b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "53677d793d31", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/53677d793d31.json"}, "html": {"href": "#!/osrf/sdformat/commits/53677d793d31"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2019-09-20T21:49:34.343280+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117805695.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117805695"}}, "parent": {"id": 117663393, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117663393.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117663393"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "[ign-gazebo PR](https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff)", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/ignitionrobotics/ign-gazebo/pull-requests/433/handle-relative-uris/diff\" rel=\"nofollow\">ign-gazebo PR</a></p>", "type": "rendered"}, "created_on": "2019-09-20T21:47:38.563458+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-09-20T21:47:38.574792+00:00", "type": "pullrequest_comment", "id": 117805695}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117663393.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117663393"}}, "parent": {"id": 117659974, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117659974.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117659974"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Done in 53677d7.\n\nI'll make the `ign-gazebo` PR tomorrow.", "markup": "markdown", "html": "<p>Done in <a href=\"#!/osrf/sdformat/commits/53677d7\" rel=\"nofollow\" class=\"ap-connect-link\">53677d7</a>.</p>\n<p>I'll make the <code>ign-gazebo</code> PR tomorrow.</p>", "type": "rendered"}, "created_on": "2019-09-20T02:29:35.785967+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-09-20T02:29:35.794766+00:00", "type": "pullrequest_comment", "id": 117663393}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?\r\n* It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "5e4a0b3b5f2b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e4a0b3b5f2b.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e4a0b3b5f2b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "53677d793d31", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/53677d793d31.json"}, "html": {"href": "#!/osrf/sdformat/commits/53677d793d31"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2019-09-20T02:28:43.934713+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117659974.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117659974"}}, "parent": {"id": 117653023, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117653023.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117653023"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Since we have a `Mesh::SetUri` member, we'd need to store the file path within `Mesh` to reconstruct the `FullPathUri` when a new URI is set. So I think it's just cleaner to expose `Mesh::FilePath` and `ign-gazebo` can combine that with URI as it sees fit for internal use.", "markup": "markdown", "html": "<p>Since we have a <code>Mesh::SetUri</code> member, we'd need to store the file path within <code>Mesh</code> to reconstruct the <code>FullPathUri</code> when a new URI is set. So I think it's just cleaner to expose <code>Mesh::FilePath</code> and <code>ign-gazebo</code> can combine that with URI as it sees fit for internal use.</p>", "type": "rendered"}, "created_on": "2019-09-20T01:11:21.901778+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-09-20T01:11:21.910371+00:00", "type": "pullrequest_comment", "id": 117659974}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117653023.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117653023"}}, "parent": {"id": 117652208, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117652208.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117652208"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "one use case would be trying to serialize the DOM objects back to an XML document and have them match the original exactly, but I'm not sure that is realistic or even a goal for us", "markup": "markdown", "html": "<p>one use case would be trying to serialize the DOM objects back to an XML document and have them match the original exactly, but I'm not sure that is realistic or even a goal for us</p>", "type": "rendered"}, "created_on": "2019-09-19T22:56:29.069321+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-19T22:56:29.078648+00:00", "type": "pullrequest_comment", "id": 117653023}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117652208.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117652208"}}, "parent": {"id": 117649000, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117649000.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117649000"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "> I can add FullPathUri functions and leave Uris untouched, so the SDF->msgs conversion in ign-gazebo can use that and ignore Uri. How does that sound?\n\nI like that. The `SDF->msgs` conversion is in a downstream application and so `ign-gazebo` can choose to put the resolved path there. I'm not sure if the serialized message needs to maintain the relative path and the `filepath`. Maybe there's a use case I'm not thinking about.", "markup": "markdown", "html": "<blockquote>\n<p>I can add FullPathUri functions and leave Uris untouched, so the SDF-&gt;msgs conversion in ign-gazebo can use that and ignore Uri. How does that sound?</p>\n</blockquote>\n<p>I like that. The <code>SDF-&gt;msgs</code> conversion is in a downstream application and so <code>ign-gazebo</code> can choose to put the resolved path there. I'm not sure if the serialized message needs to maintain the relative path and the <code>filepath</code>. Maybe there's a use case I'm not thinking about.</p>", "type": "rendered"}, "created_on": "2019-09-19T22:43:12.056429+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {}, "updated_on": "2019-09-19T22:43:12.068140+00:00", "type": "pullrequest_comment", "id": 117652208}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117649132.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117649132"}}, "parent": {"id": 117647400, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117647400.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117647400"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I can go either way. If we're striving for the class API to be as close to the spec as possible, I think using `Uri` for the raw value would be more appropriate.", "markup": "markdown", "html": "<p>I can go either way. If we're striving for the class API to be as close to the spec as possible, I think using <code>Uri</code> for the raw value would be more appropriate.</p>", "type": "rendered"}, "created_on": "2019-09-19T21:57:23.205889+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-09-19T21:57:23.216251+00:00", "type": "pullrequest_comment", "id": 117649132}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117649000.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117649000"}}, "parent": {"id": 117645546, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117645546.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117645546"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Yeah that would be one way to work around the concern I had above that *SDFormat shouldn't be changing the URI value and instead just reading it and passing it along*, without adding a `Mesh::FilePath` function and having to change `ign-msgs`. I can add `FullPathUri` functions and leave `Uri`s untouched, so the `SDF->msgs` conversion in `ign-gazebo` can use that and ignore `Uri`. How does that sound?\n\nAnother option is just to go with `Mesh::FilePath`, which is cleaner and potentially more helpful in my opinion, but also change `msgs` and target this at Citadel.", "markup": "markdown", "html": "<p>Yeah that would be one way to work around the concern I had above that <em>SDFormat shouldn't be changing the URI value and instead just reading it and passing it along</em>, without adding a <code>Mesh::FilePath</code> function and having to change <code>ign-msgs</code>. I can add <code>FullPathUri</code> functions and leave <code>Uri</code>s untouched, so the <code>SDF-&gt;msgs</code> conversion in <code>ign-gazebo</code> can use that and ignore <code>Uri</code>. How does that sound?</p>\n<p>Another option is just to go with <code>Mesh::FilePath</code>, which is cleaner and potentially more helpful in my opinion, but also change <code>msgs</code> and target this at Citadel.</p>", "type": "rendered"}, "created_on": "2019-09-19T21:55:33.674974+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2019-09-19T21:55:33.683925+00:00", "type": "pullrequest_comment", "id": 117649000}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117647400.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117647400"}}, "parent": {"id": 117646180, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117646180.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117646180"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "another option is to add another API that provides the raw value, and let `Mesh::Uri` be the smart API. that would minimize downstream effects on gazebo", "markup": "markdown", "html": "<p>another option is to add another API that provides the raw value, and let <code>Mesh::Uri</code> be the smart API. that would minimize downstream effects on gazebo</p>", "type": "rendered"}, "created_on": "2019-09-19T21:38:10.516002+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-19T21:38:10.525777+00:00", "type": "pullrequest_comment", "id": 117647400}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117646180.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117646180"}}, "parent": {"id": 117645974, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117645974.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117645974"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "we added `Element::FilePath` and `Element::SetFilePath` as bare accessors but `Element::StringAsFullPath` as the smart function\n\nI think it's definitely more convenient to keep the existing API for Mesh and Actor", "markup": "markdown", "html": "<p>we added <code>Element::FilePath</code> and <code>Element::SetFilePath</code> as bare accessors but <code>Element::StringAsFullPath</code> as the smart function</p>\n<p>I think it's definitely more convenient to keep the existing API for Mesh and Actor</p>", "type": "rendered"}, "created_on": "2019-09-19T21:22:35.755107+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-19T21:22:35.767132+00:00", "type": "pullrequest_comment", "id": 117646180}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117645974.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117645974"}}, "parent": {"id": 117645546, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117645546.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117645546"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I think some relevant context is that we have been discussing a similar issue with the `Pose()` accessors in several DOM classes, and what they should return once we add the new frame semantics. I think there's a philosophical / design aspect to the question", "markup": "markdown", "html": "<p>I think some relevant context is that we have been discussing a similar issue with the <code>Pose()</code> accessors in several DOM classes, and what they should return once we add the new frame semantics. I think there's a philosophical / design aspect to the question</p>", "type": "rendered"}, "created_on": "2019-09-19T21:20:11.617889+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2019-09-19T21:20:11.627314+00:00", "type": "pullrequest_comment", "id": 117645974}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117645546.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117645546"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Would it make sense to create another similarly named function to get the URI with the file path prepended? Alternatively, we can have `Uri` take a bool argument with a default value to specify whether the user wants the text in the `<uri>` tag or the resolved file path, with the default being the text in the `<uri>` tag. I know this means we have to modify ign-gazebo and osrf/gazebo, but I would be okay with that. I just don't know if the DOM object is supposed to be doing these kind of manipulations without being explicitly told to do so.", "markup": "markdown", "html": "<p>Would it make sense to create another similarly named function to get the URI with the file path prepended? Alternatively, we can have <code>Uri</code> take a bool argument with a default value to specify whether the user wants the text in the <code>&lt;uri&gt;</code> tag or the resolved file path, with the default being the text in the <code>&lt;uri&gt;</code> tag. I know this means we have to modify ign-gazebo and <a href=\"https://bitbucket.org/osrf/gazebo\" rel=\"nofollow\" class=\"ap-connect-link\">osrf/gazebo</a>, but I would be okay with that. I just don't know if the DOM object is supposed to be doing these kind of manipulations without being explicitly told to do so.</p>", "type": "rendered"}, "created_on": "2019-09-19T21:15:19.866778+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {}, "updated_on": "2019-09-19T21:15:19.873891+00:00", "type": "pullrequest_comment", "id": 117645546}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?\r\n* It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "5e4a0b3b5f2b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e4a0b3b5f2b.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e4a0b3b5f2b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "bbd2130c49ee", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/bbd2130c49ee.json"}, "html": {"href": "#!/osrf/sdformat/commits/bbd2130c49ee"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2019-09-19T21:05:30.236796+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117639655.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117639655"}}, "parent": {"id": 117475122, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117475122.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117475122"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Thanks for handling this, looks good to me. Merged in.", "markup": "markdown", "html": "<p>Thanks for handling this, looks good to me. Merged in.</p>", "type": "rendered"}, "created_on": "2019-09-19T20:17:06.569238+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-09-19T20:17:06.588705+00:00", "type": "pullrequest_comment", "id": 117639655}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?\r\n* It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "5e4a0b3b5f2b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e4a0b3b5f2b.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e4a0b3b5f2b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "c81c461b0014", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/c81c461b0014.json"}, "html": {"href": "#!/osrf/sdformat/commits/c81c461b0014"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2019-09-19T20:16:44.807279+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117475122.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117475122"}}, "parent": {"id": 116885492, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116885492.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116885492"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I've added an error message to `Element::StringAsFullPath` when loaded from a `data-string` in e27a2413be10 (branch `rel_path_scpeters`)", "markup": "markdown", "html": "<p>I've added an error message to <code>Element::StringAsFullPath</code> when loaded from a <code>data-string</code> in <a href=\"#!/osrf/sdformat/commits/e27a2413be10\" rel=\"nofollow\" class=\"ap-connect-link\">e27a2413be10</a> (branch <code>rel_path_scpeters</code>)</p>", "type": "rendered"}, "created_on": "2019-09-19T00:06:38.702262+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-09-19T00:06:38.712253+00:00", "type": "pullrequest_comment", "id": 117475122}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117464703.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117464703"}}, "parent": {"id": 117463899, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117463899.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117463899"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "Nah, I should have backed the PR with proper documentation to begin with. And this was a good exercise :bulb: ", "markup": "markdown", "html": "<p>Nah, I should have backed the PR with proper documentation to begin with. And this was a good exercise <img class=\"emoji\" src=\"data/pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/551c9814-1d37-4573-819d-afab3afeaf32/48x48/1f4a1.png\" alt=\"\ud83d\udca1\" title=\":bulb:\" data-emoji-short-name=\":bulb:\" /> </p>", "type": "rendered"}, "created_on": "2019-09-18T21:27:52.319810+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-09-18T21:27:52.330815+00:00", "type": "pullrequest_comment", "id": 117464703}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117463899.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117463899"}}, "parent": {"id": 117102220, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117102220.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117102220"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "> \"Relative URI references are distinguished from absolute URI in that they do not begin with a scheme name.\"\n\nmy apologies for not doing my research; your original proposal is correct", "markup": "markdown", "html": "<blockquote>\n<p>\"Relative URI references are distinguished from absolute URI in that they do not begin with a scheme name.\"</p>\n</blockquote>\n<p>my apologies for not doing my research; your original proposal is correct</p>", "type": "rendered"}, "created_on": "2019-09-18T21:18:35.789181+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-09-18T21:18:35.800562+00:00", "type": "pullrequest_comment", "id": 117463899}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"update": {"description": "tl;dr\r\n\r\nSupport using paths relative to the SDF file within:\r\n\r\n* `<mesh><uri>`\r\n* `<actor><skin><filename>`\r\n* `<actor><animation><filename>` \r\n\r\nThat is, for this file tree:\r\n\r\n```\r\nsome_model/\r\n\u251c\u2500\u2500 meshes\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 some_mesh.dae\r\n\u251c\u2500\u2500 model.config\r\n\u2514\u2500\u2500 model.sdf\r\n```\r\n\r\n`model.sdf` may reference the mesh as follows:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\n## Alternatives\r\n\r\nOn Gazebo classic, it would usually have been like this:\r\n\r\n```\r\n                <geometry>\r\n                    <mesh>\r\n                        <uri>model://some_model/meshes/some_mesh.dae</uri>\r\n                    </mesh>\r\n                </geometry>\r\n```\r\n\r\nWhere `model://` would get substituted by paths in the user's `GAZEBO_MODEL_PATH` until a valid file was found.\r\n\r\nAs we move to models hosted on Ignition Fuel, just the model name becomes insufficient to fully identify a model, so we need better ways of referring to resources.\r\n\r\nSome alternatives considered:\r\n\r\n* `https://`\r\n\r\n    * Status:\r\n    \r\n        * Partial support on Gazebo 9\r\n        * Supported within `<include><uri>` on Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Full URL must be known while creating model. When referring to resources belonging to the same model, it's a chicken and egg problem: how to know the resource URL before uploading the model to the site?\r\n        * Tied to an online service\r\n        \r\n    \r\n* Absolute path \\(`file:///`, `/`\\)\r\n\r\n    * Status:\r\n    \r\n        * Supported both on Gazebo 9 and Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        \r\n    * Cons:\r\n    \r\n        * Not easily portable from one computer to another\r\n        * Exposes creator's username \\(`/home/username/...`\\)\r\n        \r\n    \r\n* `model://`\r\n\r\n    * Status:\r\n    \r\n        * Full support on Gazebo 9\r\n        * Partial support for meshes on Ignition. Gets converted to absolute path after downloaded from Fuel.\r\n        \r\n    * Pros:\r\n    \r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Ambiguous, no owner / host site info\r\n        \r\n    \r\n* Relative path `meshes/`\r\n\r\n    * Status:\r\n    \r\n        * Support added on this PR, to be used by Ignition\r\n        \r\n    * Pros:\r\n    \r\n        * No ambiguity\r\n        * Portable\r\n        \r\n    * Cons:\r\n    \r\n        * Hard to share resources across models\r\n        \r\n    \r\n\r\nGiven that all alternatives have pros and cons, there isn't one right answer, so we need to support multiple approaches. This pull request adds support for relative paths without breaking any of the previous use cases \\*\\*. We should still address its \"con\", which is the difficulty of sharing resources across models. But that isn't supported at all on Ignition yet, so I think it can be considered out of the scope of this PR.\r\n\r\nIt's also worth mentioning that we've already been using relative paths inside `DAE` and `OBJ` files for a while, so it's only natural to extend it to SDF.\r\n\r\n\\*\\* Except for relative paths to the directory `ign gazebo` is called from, which I don't think is a common case.\r\n\r\n## Try it out\r\n\r\nLaunch `ign gazebo`:\r\n\r\n`ign gazebo -v 3`\r\n\r\nSpawn an example model with relative paths that I uploaded to Fuel:\r\n\r\n```\r\nign service -s /world/default/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/X1 Config 1 - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"vehicle\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\nSee that all meshes are properly loaded.\r\n\r\nTo try actors, you'll need [this ign-gazebo PR](https://bitbucket.org/mingfeisun/ign-gazebo/pull-requests/4/support-spawning-actors-at-runtime/diff), and you can spawn an actor with relative paths like this (world must use ogre 1):\r\n\r\n```\r\nign service -s /world/actors/create \\\r\n--reqtype ignition.msgs.EntityFactory \\\r\n--reptype ignition.msgs.Boolean \\\r\n--timeout 5000 \\\r\n--req 'sdf: '\\\r\n'\"<?xml version=\\\"1.0\\\" ?>'\\\r\n'<sdf version=\\\"1.6\\\">'\\\r\n'<include>'\\\r\n'<uri>https://fuel.ignitionrobotics.org/1.0/chapulina/models/actor - relative paths</uri>'\\\r\n'</include>'\\\r\n'</sdf>\" '\\\r\n'pose: {position: {z: 1}} '\\\r\n'name: \"person\" '\\\r\n'allow_renaming: true'\r\n```\r\n\r\n## Questions\r\n\r\n* With the current implementation, `mesh->Element()->Get<std::string>(\"uri\")` will be different from `mesh->Uri()`. Is it better to also change the `uri` within the element to keep them consistent?\r\n* It could be argued that SDFormat shouldn't be changing the URI value and instead just reading it and passing it along. I'm fine with that, but for downstream applications that can't rely on `mesh->Element()` \\(because the mesh object is serialized\\), we'd need to add things like `Mesh::FilePath`, a `filepath` field to the equivalent ign-msg, etc, which break ABI. \\(ok, this is not a question, more like a disclaimer :grimacing: \\)", "title": "Accept relative path in <uri>", "destination": {"commit": {"hash": "5e4a0b3b5f2b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/5e4a0b3b5f2b.json"}, "html": {"href": "#!/osrf/sdformat/commits/5e4a0b3b5f2b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "sdf8"}}, "reason": "", "source": {"commit": {"hash": "35415309db33", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/sdformat/commit/35415309db33.json"}, "html": {"href": "#!/osrf/sdformat/commits/35415309db33"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/sdformat.json"}, "html": {"href": "#!/osrf/sdformat"}, "avatar": {"href": "data/bytebucket.org/ravatar/{b6d52f9f-b070-41c0-807c-94af07ea375b}ts=1606789"}}, "type": "repository", "name": "sdformat", "full_name": "osrf/sdformat", "uuid": "{b6d52f9f-b070-41c0-807c-94af07ea375b}"}, "branch": {"name": "rel_path"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2019-09-18T21:14:16.543739+00:00"}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/117102220.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-117102220"}}, "parent": {"id": 116901627, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901627.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901627"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "So, there's a problem with this. Gazebo-classic currently accepts substituting `file://` for `GAZEBO_RESOURCE_PATH`. This is how `<uri>file://media/materials/scripts/gazebo.material</uri>` works, for example. So interpreting it as a relative path would break Gazebo compatibility. I also noticed several ROS packages use this pattern.\n\nSo I'm standing behind my original proposal, and now with some formal backing:\n\n* From [RFC 2396](https://tools.ietf.org/html/rfc2396):\n    * _\"Relative addressing of URI allows document trees to be partially independent of their location and access scheme.\"_ - that's what we want\n    * _\"Relative URI references are distinguished from absolute URI in that they do not begin with a scheme name.\"_ - that's what this PR supports\n    * _\"A relative reference beginning with a single slash character is termed an absolute-path reference\"_ - that's already supported by SDF\n* From [XML Schema 1.0](http://www.datypic.com/sc/xsd/t-xsd_anyURI.html)'s `xsd::anyURI` docs:\n    * _\"Relative URIs are specified as the difference from a base URI, such as ../prod.html.\"_\n\n---\n\n## Fun facts\n\n* Gazebo-classic has `materials/textures` hardcoded internally, which allows COLLADA files like [this](https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/cardboard_box/meshes/cardboard_box.dae#lines-143) and OBJ files like [this](https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/suv/meshes/suv.mtl#lines-29) to refer to their textures just by the filename without any path.\n\n* Both Gazebo-classic and Ignition support relative paths within COLLADA files like [this](https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/hinged_door/meshes/door.dae#lines-949) and OBJ files like [this](https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/cloverleaf_interchange/meshes/cloverleaf.mtl#lines-15).\n", "markup": "markdown", "html": "<p>So, there's a problem with this. Gazebo-classic currently accepts substituting <code>file://</code> for <code>GAZEBO_RESOURCE_PATH</code>. This is how <code>&lt;uri&gt;file://media/materials/scripts/gazebo.material&lt;/uri&gt;</code> works, for example. So interpreting it as a relative path would break Gazebo compatibility. I also noticed several ROS packages use this pattern.</p>\n<p>So I'm standing behind my original proposal, and now with some formal backing:</p>\n<ul>\n<li>From <a data-is-external-link=\"true\" href=\"https://tools.ietf.org/html/rfc2396\" rel=\"nofollow\">RFC 2396</a>:<ul>\n<li><em>\"Relative addressing of URI allows document trees to be partially independent of their location and access scheme.\"</em> - that's what we want</li>\n<li><em>\"Relative URI references are distinguished from absolute URI in that they do not begin with a scheme name.\"</em> - that's what this PR supports</li>\n<li><em>\"A relative reference beginning with a single slash character is termed an absolute-path reference\"</em> - that's already supported by SDF</li>\n</ul>\n</li>\n<li>From <a data-is-external-link=\"true\" href=\"http://www.datypic.com/sc/xsd/t-xsd_anyURI.html\" rel=\"nofollow\">XML Schema 1.0</a>'s <code>xsd::anyURI</code> docs:<ul>\n<li><em>\"Relative URIs are specified as the difference from a base URI, such as ../prod.html.\"</em></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h2 id=\"markdown-header-fun-facts\">Fun facts</h2>\n<ul>\n<li>\n<p>Gazebo-classic has <code>materials/textures</code> hardcoded internally, which allows COLLADA files like <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/cardboard_box/meshes/cardboard_box.dae#lines-143\" rel=\"nofollow\">this</a> and OBJ files like <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/suv/meshes/suv.mtl#lines-29\" rel=\"nofollow\">this</a> to refer to their textures just by the filename without any path.</p>\n</li>\n<li>\n<p>Both Gazebo-classic and Ignition support relative paths within COLLADA files like <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/hinged_door/meshes/door.dae#lines-949\" rel=\"nofollow\">this</a> and OBJ files like <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo_models/src/e6d645674e8a99cb7955ce3b9a1fbe26c58c41f2/cloverleaf_interchange/meshes/cloverleaf.mtl#lines-15\" rel=\"nofollow\">this</a>.</p>\n</li>\n</ul>", "type": "rendered"}, "created_on": "2019-09-16T23:44:23.456860+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-09-16T23:44:23.465358+00:00", "type": "pullrequest_comment", "id": 117102220}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901627.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901627"}}, "parent": {"id": 116901216, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901216.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901216"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "thanks for your patience!\n", "markup": "markdown", "html": "<p>thanks for your patience!</p>", "type": "rendered"}, "created_on": "2019-09-13T22:56:05.940984+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-09-13T22:56:05.954256+00:00", "type": "pullrequest_comment", "id": 116901627}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901216.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901216"}}, "parent": {"id": 116901065, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901065.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901065"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I'm ok with `file://rel/path.dae`. I'll make the changes :thumbsup: Thanks for iterating!", "markup": "markdown", "html": "<p>I'm ok with <code>file://rel/path.dae</code>. I'll make the changes <img class=\"emoji\" src=\"data/pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/551c9814-1d37-4573-819d-afab3afeaf32/48x48/1f44d.png\" alt=\"\ud83d\udc4d\" title=\":thumbsup:\" data-emoji-short-name=\":thumbsup:\" /> Thanks for iterating!</p>", "type": "rendered"}, "created_on": "2019-09-13T22:46:20.932269+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-09-13T22:46:20.941105+00:00", "type": "pullrequest_comment", "id": 116901216}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116901065.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116901065"}}, "parent": {"id": 116891280, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116891280.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116891280"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I don't want to derail this, but it just seems weird to me that the content of the `<uri>` tag would not be a URI, since a scheme is required\n\nand [wikipedia says](https://en.wikipedia.org/wiki/File_URI_scheme#How_many_slashes?) `file://relative/path` is not valid according to [RFC8089](https://tools.ietf.org/html/rfc8089) but lots of people do it anyway\n\nso we could follow the crowd and misuse `file:`, use a different scheme like `path:` or just use a non-URI string with no scheme", "markup": "markdown", "html": "<p>I don't want to derail this, but it just seems weird to me that the content of the <code>&lt;uri&gt;</code> tag would not be a URI, since a scheme is required</p>\n<p>and <a data-is-external-link=\"true\" href=\"https://en.wikipedia.org/wiki/File_URI_scheme#How_many_slashes?\" rel=\"nofollow\">wikipedia says</a> <code>file://relative/path</code> is not valid according to <a data-is-external-link=\"true\" href=\"https://tools.ietf.org/html/rfc8089\" rel=\"nofollow\">RFC8089</a> but lots of people do it anyway</p>\n<p>so we could follow the crowd and misuse <code>file:</code>, use a different scheme like <code>path:</code> or just use a non-URI string with no scheme</p>", "type": "rendered"}, "created_on": "2019-09-13T22:42:48.566196+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-09-13T22:42:48.576569+00:00", "type": "pullrequest_comment", "id": 116901065}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116900112.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116900112"}}, "parent": {"id": 116899872, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116899872.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116899872"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "> `file://path` (i.e. two slashes, without a hostname) is never correct, but is often used.\n\nwow", "markup": "markdown", "html": "<blockquote>\n<p><code>file://path</code> (i.e. two slashes, without a hostname) is never correct, but is often used.</p>\n</blockquote>\n<p>wow</p>", "type": "rendered"}, "created_on": "2019-09-13T22:19:33.772490+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-09-13T22:19:33.782184+00:00", "type": "pullrequest_comment", "id": 116900112}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116899872.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116899872"}}, "parent": {"id": 116899734, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558/comments/116899734.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558/_/diff#comment-116899734"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}, "content": {"raw": "I also thought that was allowed, but [apparently](https://stackoverflow.com/a/15193744) it isn't!", "markup": "markdown", "html": "<p>I also thought that was allowed, but <a data-is-external-link=\"true\" href=\"https://stackoverflow.com/a/15193744\" rel=\"nofollow\">apparently</a> it isn't!</p>", "type": "rendered"}, "created_on": "2019-09-13T22:15:09.886723+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2019-09-13T22:15:09.896935+00:00", "type": "pullrequest_comment", "id": 116899872}, "pull_request": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/osrf/sdformat/pullrequests/558.json"}, "html": {"href": "#!/osrf/sdformat/pull-requests/558"}}, "title": "Accept relative path in <uri>"}}], "next": "data/repositories/osrf/sdformat/pullrequests/558/activity_ctx=axHE7IaCE.json"}